goroam.xdcomm.check_host=function(D){var C=true;D=D.toLowerCase();var A="<%= Constant::get(:xdcomm_ignore_hosts) %>".toLowerCase().split(",");for(var B=0;B<A.length;B++){if(D==A[B].trim()){C=false;break}}return C};goroam.xdcomm.create_iframe=function(B){var C=goroam.xdcomm.get_hidden_iframe_container();var A=document.createElement("iframe");if(goroam.browser.host_info().name===goroam.enm.browsers.ie){A.src=B;C.appendChild(A)}else{C.appendChild(A);A.src=B}return A};goroam.xdcomm.get_hidden_iframe_container=function(){if(!goroam.xdcomm.__container){goroam.xdcomm.__container=document.createElement("div");goroam.xdcomm.__container.style.display="none";document.getElementsByTagName("body")[0].appendChild(goroam.xdcomm.__container)}return goroam.xdcomm.__container};goroam.xdcomm.get_element_data=function(D){var C="";if(D){var B=goroam.dhtml.get_element_data(D);var A=(B.title==null?"":B.title);var E=(B.value==null?"":B.value);C="<item><title><![CDATA["+A+"]]></title><value><![CDATA["+E+"]]></value><data_type_id>"+B.data_type+"</data_type_id></item>"}return C};goroam.xdcomm.process=function(){var A=window.parent;if(A!=window){var E=document.URL;var F=E.indexOf("#");var H=E.substring(F+1);if(H!=""){var C=false;var I="",D="",G="";if(H.in_str("&sig=")){D=H.right_of_rev("&sig=");I=H.left_of_rev("&sig=");if(I.in_str("&subdir=")){G=I.right_of_rev("&subdir=");I=I.left_of_rev("&subdir=")}I=decodeURIComponent(I);C=(decodeURIComponent(D)===(I+A.location.host.toLowerCase()).md5())}if(C&&goroam.xdcomm.check_host(A.location.host)){var B=new goroam.http.request();var E="<%= Constant::get(:root_url) %>"+G;B.open("post",E,true);B.set_request_header("Content-Type","text/xml");B.send(I)}}}};goroam.xdcomm.send=function(C,B){if(goroam.xdcomm.should_send(window.location.host,C)){var D="<%= Constant::get(:root_url) %>/xd.htm";var A=(C+window.location.host.toLowerCase()).md5();goroam.xdcomm.create_iframe(D+"#"+encodeURIComponent(C)+"&subdir="+(B||"")+"&sig="+encodeURIComponent(A))}};goroam.xdcomm.send_element=function(A){if(goroam.xdcomm.should_send(window.location.host)){goroam.xdcomm.send(goroam.xdcomm.get_element_data(A),"/"+A.getAttribute("lat")+"/"+A.getAttribute("lng")+".xml")}};goroam.xdcomm.should_send=function(B,C){var A=true;C=(C||"");if(C==""){A=false}else{A=goroam.xdcomm.check_host(B)}return A}