goroam.google.maps.version="2.142";if((goroam.browser.host_info().name==goroam.enm.browsers.safari)&&(goroam.browser.host_info().major_ver<525)){goroam.google.maps.version="2.88"}google.load("maps",goroam.google.maps.version);goroam.google.maps.__active_map=undefined;goroam.google.maps.__active_map_id="<%= @settings[:map] %>";goroam.google.maps.__page_maps={};goroam.google.maps.__lat_attr="<%= Constant::get(:lat_attribute) %>";goroam.google.maps.__lng_attr="<%= Constant::get(:lng_attribute) %>";goroam.google.maps.__map_attr="<%= Constant::get(:map_attribute) %>";google.__setOnLoadCallback=google.setOnLoadCallback;google.__onload_callback_functions=[];google.__onload_callback=function(B){for(var A=0;A<google.__onload_callback_functions.length;A++){google.__onload_callback_functions[A](B)}};google.__setOnLoadCallback(google.__onload_callback);google.setOnLoadCallback=function(A){google.__onload_callback_functions.add_if_new(A)};goroam.google.maps.extend_functionality=function(){google.maps.Map2.prototype.active_marker=undefined;google.maps.Map2.prototype.__bounds=new google.maps.LatLngBounds();google.maps.Map2.prototype.add_lat_lng=function(A,C){var E=A+"_"+C;if(!this.__lat_lng){this.__lat_lng={}}if(this.__lat_lng[E]){}else{var B=new google.maps.LatLng(A,C);var D=goroam.google.maps.create_marker(B);this.__lat_lng[E]=D;this.addOverlay(this.__lat_lng[E]);this.__bounds.extend(B)}return this.__lat_lng[E]};google.maps.Map2.prototype.__addOverlay=google.maps.Map2.prototype.addOverlay;google.maps.Map2.prototype.addOverlay=function(A){this.__addOverlay(A);A.map=this};google.maps.Map2.prototype.__removeOverlay=google.maps.Map2.prototype.removeOverlay;google.maps.Map2.prototype.removeOverlay=function(A){this.__removeOverlay(A);A.map=undefined};google.maps.Map2.prototype.create_active_marker=function(B,A){B=(B||this.getCenter());this.active_marker=goroam.google.maps.create_marker(B,{draggable:true});this.addOverlay(this.active_marker);goroam.event.addListener(this.active_marker,"dragend",function(C){goroam.event.trigger(this.map,"location_found",C)})};google.maps.Map2.prototype.goto_location=function(A){goroam.google.maps.find_location(this,A,function(D,B,C){if(C&&C.ExtendedData&&C.ExtendedData.LatLonBox){this.recenter_active_marker(D,new google.maps.LatLngBounds(new google.maps.LatLng(C.ExtendedData.LatLonBox.south,C.ExtendedData.LatLonBox.west),new google.maps.LatLng(C.ExtendedData.LatLonBox.north,C.ExtendedData.LatLonBox.east)))}else{this.recenter_active_marker(D)}goroam.event.trigger(this,"location_found",D,B,C)})};google.maps.Map2.prototype.recenter_active_marker=function(A,B){if(this.active_marker){this.active_marker.setLatLng(A)}else{this.create_active_marker(A,false)}if(goroam.system.is_numeric(B)||(B==undefined)){this.setCenter(A,B)}else{this.resize_to_bounds(B)}};google.maps.Map2.prototype.recenter_active_marker_on_event=function(A){A=A.toLowerCase();if(A=="dblclick"){this.disableDoubleClickZoom()}google.maps.Event.addListener(this,A,function(C,B){this.recenter_active_marker(B)})};google.maps.Map2.prototype.resize_to_bounds=function(A){var C=false;A=(A||this.__bounds);if(A&&!A.isEmpty()){var B=this.getBoundsZoomLevel(A);this.setCenter(A.getCenter(),B)}return C};google.maps.Map2.prototype.show_focus=function(A){if(!this.__focus_overlay){this.__focus_overlay=goroam.google.maps.create_focus_overlay(A);this.addOverlay(this.__focus_overlay)}else{if(this.__focus_overlay.map!=this){this.addOverlay(this.__focus_overlay)}this.__focus_overlay.setLatLng(A)}};google.maps.Map2.prototype.show_layer=function(A){if(!this.__layers){this.__layers={}}if(!this.__layers[A]){this.__layers[A]=new google.maps.Layer(A);this.addOverlay(this.__layers[A])}this.__layers[A].show()};google.maps.Map2.prototype.hide_layer=function(A){if(!this.__layers){this.__layers={}}if(this.__layers[A]){this.__layers[A].hide()}};goroam.google.maps.html_overlay=function(B){var A=this;if(B&&B.container){A.__container=B.container}else{A.__container=document.createElement("div")}goroam.dhtml.edit_class_name(A.__container,"<%= Constant::get(:css_prefix) %>html_overlay"+((B&&B.class_name)?" "+B.class_name:""),"",true);if(B&&B.lat_lng){A.__lat_lng=B.lat_lng}A.__position=(B&&B.position)?B.position:""};goroam.google.maps.html_overlay.prototype=new google.maps.Overlay();goroam.google.maps.html_overlay.prototype.copy=function(){var A=this;var B=new goroam.google.maps.html_overlay({container:A.__container.cloneNode(true),lat_lng:A.__lat_lng,position:A.__position});return B};goroam.google.maps.html_overlay.prototype.get_container=function(){return this.__container};goroam.google.maps.html_overlay.prototype.getLatLng=function(){return this.__lat_lng};goroam.google.maps.html_overlay.prototype.initialize=function(B){var A=this;A.__container.style.position="absolute";A.map=B;A.map.getPane(G_MAP_MARKER_PANE).appendChild(A.__container)};goroam.google.maps.html_overlay.prototype.setLatLng=function(B){var A=this;var C=false;if(B){A.__lat_lng=B;A.redraw(true);C=true}return C};goroam.google.maps.html_overlay.prototype.redraw=function(C){var A=this;if(!C||!(A.map)){return }var D=A.map.fromLatLngToDivPixel(A.__lat_lng);var B=new goroam.math.compass_position(A.__position);A.__container.style.left=B.get_left(D.x,A.__container.offsetWidth)+"px";A.__container.style.top=B.get_top(D.y,A.__container.offsetHeight)+"px"};goroam.google.maps.html_overlay.prototype.remove=function(){var A=this.__container;A.parentNode.removeChild(A)}};goroam.google.maps.create_focus_overlay=function(A){var B=new goroam.google.maps.html_overlay({lat_lng:A,class_name:"<%= Constant::get(:css_prefix) %>focus_overlay"});B.__redraw=B.redraw;B.redraw=function(D){var C=this;goroam.dhtml.edit_class_name(C.get_container(),"focus_overlay_stage1");C.__redraw(D);window.setTimeout(function(){goroam.dhtml.edit_class_name(C.get_container(),"focus_overlay_stage2","focus_overlay_stage1");C.__redraw(D);window.setTimeout(function(){goroam.dhtml.edit_class_name(C.get_container(),"focus_overlay_stage3","focus_overlay_stage2");C.__redraw(D);window.setTimeout(function(){goroam.dhtml.edit_class_name(C.get_container(),"","focus_overlay_stage3");C.__redraw(D);C.map.removeOverlay(C)},parseInt("<%= Constant::get(:focus_overlay_interval) %>"))},parseInt("<%= Constant::get(:focus_overlay_interval) %>"))},parseInt("<%= Constant::get(:focus_overlay_interval) %>"))};return B};goroam.google.maps.create_marker=function(B,C){var A=false;if(C&&C.draggable){A=C.draggable}if(!C){C={}}C.draggable=true;C.icon=goroam.google.maps.create_stock_icon("<%= @settings[:marker_icon] %>");var D=new google.maps.Marker(B,C);if(!A){D.disableDragging()}return D};goroam.google.maps.create_icon=function(C,B){var D=new google.maps.Icon();B=(B||"");for(var A in C){switch(A){case"image":case"printImage":case"printShadow":case"shadow":case"transparent":D[A]=B+C[A];break;default:D[A]=C[A]}}return D};goroam.google.maps.create_stock_icon=function(A){A=(A||goroam.enm.icons.pushpin.orange).toLowerCase();var B="<%= Constant::get(:root_url) %>/images/icons/markers/";var C,D;switch(A){case goroam.enm.icons.pushpin.blue:case goroam.enm.icons.pushpin.green:case goroam.enm.icons.pushpin.orange:case goroam.enm.icons.pushpin.red:C={iconAnchor:new google.maps.Point(9,32),iconSize:new google.maps.Size(32,32),image:"red_pushpin.png",imageMap:[9,32,10,29,11,25,5,16,10,12,14,6,12,2,14,0,18,0,26,6,21,15,23,18,23,22,20,24,14,25,11,32],infoWindowAnchor:new google.maps.Point(9,32),printImage:"red_pushpin.gif",printShadow:"pushpin_shadow.gif",shadow:"pushpin_shadow.png",shadowSize:new google.maps.Size(59,32),transparent:"pushpin_transparent.png"};switch(A){case goroam.enm.icons.pushpin.blue:C.image="blue_pushpin.png";C.printImage="blue_pushpin.gif";break;case goroam.enm.icons.pushpin.green:C.image="green_pushpin.png";C.printImage="green_pushpin.gif";break;case goroam.enm.icons.pushpin.orange:C.image="orange_pushpin.png";C.printImage="orange_pushpin.gif";break}break;case goroam.enm.icons.goroam:C={iconAnchor:new google.maps.Point(8,40),iconSize:new google.maps.Size(34,40),image:"goroam.png",imageMap:[8,40,5,31,0,22,0,15,4,8,8,4,26,0,34,0,34,7,31,9,34,13,34,24,26,32,16,35,11,40],infoWindowAnchor:new google.maps.Point(8,40),printImage:"goroam.gif",printShadow:"goroam_shadow.gif",shadow:"goroam_shadow.png",shadowSize:new google.maps.Size(55,40),transparent:"goroam_transparent.png"};break}if(C){D=goroam.google.maps.create_icon(C,B)}return D};goroam.google.maps.find_location=function(A,D,C){var E=function(I){var H,F,G;if((I)&&(I.Status)){if(I.Status.code==500){goroam.google.maps.find_location(A,D,C)}else{if((I)&&(I.Placemark)){if((I.Placemark.length)&&(I.Placemark.length>0)){G=I.Placemark[0];H=G.Point;F=G.address}else{if(I.Placemark.Point){G=I.Placemark;H=G.Point;F=G.address}}if((H)&&(H.coordinates)&&(H.coordinates.length>=2)){H=new google.maps.LatLng(H.coordinates[1],H.coordinates[0])}else{H=undefined;F=undefined;G=undefined}}if(H){if(C){C.call(A,H,F,G)}}else{alert("<%= Constant::get(:location_not_found) %>")}}}};var B=new google.maps.ClientGeocoder();B.getLocations(D,E)};goroam.google.maps.get_address=function(B,C){var D=function(H){var G;if(H&&H.Placemark&&(H.Placemark.length>0)){var F=[];for(var E=0;E<H.Placemark.length;E++){F[H.Placemark[E].AddressDetails.Accuracy]=H.Placemark[E]}if(F.length>0){G=F[F.length-1]}}else{if(H&&H.Placemark){G=H.Placemark}}if(G){if(C){C.call(null,G.address,G)}}else{alert("<%= Constant::get(:address_for_geo_point_not_found) %>")}};var A=new google.maps.ClientGeocoder();A.getLocations(B,D)};goroam.google.maps.get_map=function(A){if(A&&(A!="")){goroam.google.maps.load_map_from_settings(A)}return(goroam.google.maps.__page_maps[A]||goroam.google.maps.__active_map)};goroam.google.maps.load=function(A){if(google.maps.BrowserIsCompatible()){goroam.google.maps.extend_functionality();goroam.event.addDomListener(window,"unload",goroam.google.maps.unload);if(A){A()}}else{alert("<%= Constant::get(:error_header) %><%= Constant::get(:error_browser_not_supported) %>")}};goroam.google.maps.load_active_map=function(){if(goroam.google.maps.load_map_from_settings(goroam.google.maps.__active_map_id)){goroam.google.maps.__active_map=goroam.google.maps.__page_maps[goroam.google.maps.__active_map_id]}};goroam.google.maps.load_from_page=function(){goroam.google.maps.load_active_map();var B=goroam.dhtml.get_elements_with_attribute(goroam.google.maps.__lat_attr);for(var D=0;D<B.length;D++){var A=goroam.google.maps.get_map(B[D].getAttribute(goroam.google.maps.__map_attr));if(A){var C=A.add_lat_lng(B[D].getAttribute(goroam.google.maps.__lat_attr),B[D].getAttribute(goroam.google.maps.__lng_attr));goroam.event.bind(C,"mouseover",B[D],goroam.dhtml.highlight);goroam.event.bind(C,"mouseout",B[D],goroam.dhtml.unhighlight);A.resize_to_bounds()}goroam.google.maps.add_map_prompt(B[D]);goroam.xdcomm.send_element(B[D])}};goroam.google.maps.load_map_from_settings=function(F){var E=false;var D=document.getElementById(F);if(D&&!goroam.google.maps.__page_maps[F]){var B=document.createElement("a");B.name=F;D.insertBefore(B,D.firstChild);var A=new google.maps.Map2(D);A.setCenter(new google.maps.LatLng("<%= @settings[:lat] %>","<%= @settings[:lng] %>"),parseInt("<%= @settings[:zoom] %>"));try{switch("<%= @settings[:controls] %>"){case"all":A.addControl(new GLargeMapControl());A.addControl(new GMapTypeControl());A.addControl(new GOverviewMapControl());A.addControl(new GScaleControl());break;case"all_small":A.addControl(new GSmallMapControl());A.addControl(new GMenuMapTypeControl());A.addControl(new GOverviewMapControl());A.addControl(new GScaleControl());break;case"min":A.addControl(new GMenuMapTypeControl());A.addControl(new GSmallZoomControl());break;case"none":break}}catch(C){A.addControl(new GSmallMapControl());A.addControl(new GMapTypeControl())}goroam.google.maps.__page_maps[F]=A;E=true}return E};goroam.google.maps.add_map_prompt=function(B){if(!B.__map_prompt){goroam.event.bindDom(B,"mouseover",B,goroam.dhtml.set_mouseover);goroam.event.bindDom(B,"mouseover",B,goroam.google.maps.over_map_element);goroam.event.bindDom(B,"mouseout",B,goroam.dhtml.unset_mouseover);goroam.event.bindDom(B,"mouseout",B,goroam.google.maps.leave_map_element);goroam.event.bindDom(B,"click",B,function(D){if(this.__map_prompt&&this.__map_prompt.__mouseover){goroam.dhtml.cancel_bubble(D)}});var C=document.createElement("a");C.href="#"+goroam.system.set_default(B.getAttribute(goroam.google.maps.__map_attr),"<%= @settings[:map] %>");C.innerHTML='<img src="<%= Constant::get(:root_url) %>/images/px.gif" style="border-width:0px; height:100%; width:100%;" title="<%= Constant::get(:show_on_map_prompt_text) %>" />';B.__map_prompt=document.createElement("div");B.__map_prompt.className="<%= Constant::get(:css_prefix) %>map_prompt <%= Constant::get(:css_prefix) %>map_prompt_<%= @settings[:position] %>";B.__map_prompt.appendChild(C);B.__map_prompt.__mouseover_class_name="map_prompt_hover";B.__map_prompt.__mouseout_class_name="map_prompt_hover_element";goroam.event.bindDom(C,"click",B,goroam.google.maps.show_on_map);goroam.event.bindDom(B.__map_prompt,"mouseover",B.__map_prompt,goroam.dhtml.set_mouseover);goroam.event.bindDom(B.__map_prompt,"mouseout",B.__map_prompt,goroam.dhtml.unset_mouseover);goroam.event.bindDom(B.__map_prompt,"mouseout",B,goroam.google.maps.leave_map_element);if(B.style.position!="absolute"){B.style.position="relative"}if(B.tagName.toLowerCase()=="img"){var A=document.createElement("span");A.style.position=B.style.position;B.style.position="relative";A.style.top=B.style.top;A.style.bottom=B.style.bottom;A.style.left=B.style.left;A.style.right=B.style.right;if(goroam.browser.host_info().name==goroam.enm.browsers.ie){A.style.zoom=1}B.style.top="";B.style.bottom="";B.style.left="";B.style.right="";B.parentNode.replaceChild(A,B);A.appendChild(B);A.appendChild(B.__map_prompt)}else{if((goroam.browser.host_info().name==goroam.enm.browsers.ie)&&B.currentStyle&&!B.currentStyle.hasLayout){B.style.zoom=1}B.appendChild(B.__map_prompt)}}};goroam.google.maps.over_map_element=function(){if(!this.__map_prompt.__mouseover){goroam.dhtml.edit_class_name(this.__map_prompt,"map_prompt_hover_element")}};goroam.google.maps.leave_map_element=function(){var A=this;window.setTimeout(function(){if(!A.__mouseover&&!A.__map_prompt.__mouseover){goroam.dhtml.edit_class_name(A.__map_prompt,"","map_prompt_hover_element")}},parseInt("<%= Constant::get(:exit_hover_timeout) %>"))};goroam.google.maps.show_on_map=function(F){var E=false;var B=('<%= @settings[:popup] == nil ? "false" : "true" %>'=="true"?true:false);var H=('<%= @settings[:popup_window] == nil ? "false" : "true" %>'=="true"?true:false);var D=(this.getAttribute(goroam.google.maps.__map_attr)||goroam.google.maps.__active_map_id);var A=goroam.google.maps.get_map(D);if(A&&!(B||H)){var C=new google.maps.LatLng(this.getAttribute(goroam.google.maps.__lat_attr),this.getAttribute(goroam.google.maps.__lng_attr));A.setCenter(C);A.show_focus(C);E=true}else{if(H){goroam.dhtml.cancel_bubble(F);var G=goroam.controls.popup_window("<%= Constant::get(:root_url) %>/"+this.getAttribute(goroam.google.maps.__lat_attr)+"/"+this.getAttribute(goroam.google.maps.__lng_attr)+"?layout=min&find="+goroam.dhtml.get_element_data(this).value,482,620,D,false,true);G.focus()}else{goroam.controls.popup_map(new google.maps.LatLng(this.getAttribute(goroam.google.maps.__lat_attr),this.getAttribute(goroam.google.maps.__lng_attr)));goroam.dhtml.cancel_bubble(F)}}return E};goroam.google.maps.unload=function(){google.maps.Unload()}